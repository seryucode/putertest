<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>System Diagnosis</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body { 
      font-family: "Hiragino Kaku Gothic ProN", sans-serif; 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 20px;
    }
    button { 
      padding: 15px 30px; 
      font-size: 18px; 
      cursor: pointer; 
      background: #dc3545; /* èµ¤è‰²ã§è­¦å‘Šè‰² */
      color: white; 
      border: none; 
      border-radius: 5px; 
      font-weight: bold;
      margin-top: 10px;
    }
    textarea { width: 100%; height: 80px; font-size: 16px; }
    #log { 
      background: #222; 
      color: #0f0; /* é»’èƒŒæ™¯ã«ç·‘æ–‡å­— */
      padding: 20px; 
      margin-top: 20px; 
      border-radius: 8px; 
      white-space: pre-wrap; 
      font-family: monospace;
      min-height: 200px;
    }
  </style>
</head>
<body>

  <h1>ğŸ•µï¸ ã‚¨ãƒ©ãƒ¼è§£æãƒ¢ãƒ¼ãƒ‰</h1>

  <div id="login-area">
    <p>ã¾ãšã¯Puterã¨é€£æºã™ã‚‹ã€‚</p>
    <button onclick="doLogin()">1. ãƒ­ã‚°ã‚¤ãƒ³é€£æº</button>
  </div>

  <div id="test-area" style="display:none; margin-top:20px; border-top:1px solid #ccc; padding-top:20px;">
    <p>é©å½“ãªè¨€è‘‰ã‚’å…¥ã‚Œã¦é€ä¿¡ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã€‚</p>
    <textarea id="prompt">ãƒ†ã‚¹ãƒˆ</textarea>
    <button onclick="runTest()">2. é€ä¿¡ãƒ†ã‚¹ãƒˆï¼ˆè§£æï¼‰</button>
  </div>

  <h3>ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°:</h3>
  <div id="log">å¾…æ©Ÿä¸­...</div>

  <script>
    const logEl = document.getElementById('log');

    function log(msg) {
        logEl.innerText += "\n[" + new Date().toLocaleTimeString() + "] " + msg;
    }

    // 1. ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function doLogin() {
        log("ãƒ­ã‚°ã‚¤ãƒ³è©¦è¡Œé–‹å§‹...");
        try {
            const user = await puter.auth.signIn();
            log("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: " + user.username);
            document.getElementById('test-area').style.display = 'block';
        } catch (e) {
            log("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:\n" + JSON.stringify(e, null, 2));
        }
    }

    // 2. AIãƒ†ã‚¹ãƒˆå‡¦ç†
    async function runTest() {
        const prompt = document.getElementById('prompt').value;
        log("--- ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡ ---");
        log("ãƒ¢ãƒ‡ãƒ«: æŒ‡å®šãªã—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰");
        
        try {
            // æœ€ã‚‚å˜ç´”ãªå½¢å¼ã§é€ä¿¡
            const resp = await puter.ai.chat(prompt);
            
            log("å—ä¿¡ãƒ‡ãƒ¼ã‚¿å‹: " + typeof resp);
            log("å—ä¿¡ç”Ÿãƒ‡ãƒ¼ã‚¿:\n" + JSON.stringify(resp, null, 2));
            
            // ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã®è©¦è¡Œ
            const text = resp?.message?.content?.[0]?.text || resp?.text || "æŠ½å‡ºä¸èƒ½";
            log(">> è§£èª­çµæœ: " + text);

        } catch (e) {
            log("!!! ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ !!!");
            
            // ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åˆ—æŒ™ã—ã¦è¡¨ç¤º
            let errInfo = {};
            Object.getOwnPropertyNames(e).forEach(key => {
                errInfo[key] = e[key];
            });
            
            log("ã‚¨ãƒ©ãƒ¼è©³ç´°:\n" + JSON.stringify(errInfo, null, 2));
        }
    }
  </script>
</body>
</html>
