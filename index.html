<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Claude Writing Machine</title>
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body { 
      font-family: "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif; 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 40px 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 { margin-bottom: 20px; font-size: 24px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
    textarea { 
      width: 100%; 
      height: 120px; 
      padding: 15px; 
      font-size: 16px; 
      border: 1px solid #ccc; 
      border-radius: 8px; 
      box-sizing: border-box;
      resize: vertical;
      font-family: inherit;
    }
    textarea:focus { outline: 2px solid #007bff; border-color: transparent; }

    /* ãƒœã‚¿ãƒ³ */
    button { 
      margin-top: 15px;
      padding: 12px 30px; 
      font-size: 16px; 
      font-weight: bold; 
      cursor: pointer; 
      background: #222; 
      color: white; 
      border: none; 
      border-radius: 6px; 
      transition: background 0.2s;
    }
    button:hover { background: #444; }
    button:disabled { background: #aaa; cursor: wait; }

    /* å‡ºåŠ›ã‚¨ãƒªã‚¢ */
    #output { 
      margin-top: 30px; 
      background: #fff; 
      padding: 25px; 
      border-radius: 8px; 
      min-height: 200px; 
      white-space: pre-wrap; 
      line-height: 1.8;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      border: 1px solid #e1e1e1;
    }
    
    /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
    .status { margin-left: 10px; font-size: 14px; color: #666; }
    
    /* éè¡¨ç¤ºã‚¯ãƒ©ã‚¹ */
    .hidden { display: none; }
  </style>
</head>
<body>

  <h1>ğŸ–‹ï¸ ClaudeåŸ·ç­†ãƒã‚·ãƒ³</h1>

  <div id="login-view">
    <p>åˆ©ç”¨ã«ã¯Puterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ã®é€£æºãŒå¿…è¦ã§ã™ã€‚</p>
    <button onclick="connect()">é€£æºã™ã‚‹ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰</button>
  </div>

  <div id="app-view" class="hidden">
    <textarea id="prompt" placeholder="ã“ã“ã«ãŠé¡Œã‚’å…¥åŠ›ï¼ˆä¾‹: æ·±å¤œã®ã‚³ãƒ³ãƒ“ãƒ‹ã§èµ·ã“ã‚‹å¿ƒæ¸©ã¾ã‚‹ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼‰"></textarea>
    <br>
    <button id="sendBtn" onclick="generate()">åŸ·ç­†ã™ã‚‹</button>
    <span id="status" class="status"></span>
    
    <div id="output">ï¼ˆã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
  </div>

  <script>
    // èµ·å‹•ãƒã‚§ãƒƒã‚¯
    (async function init() {
      if (puter.auth.isSignedIn()) {
        showApp();
      }
    })();

    function showApp() {
      document.getElementById('login-view').classList.add('hidden');
      document.getElementById('app-view').classList.remove('hidden');
    }

    // 1. ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function connect() {
      try {
        await puter.auth.signIn();
        showApp();
      } catch (e) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—: " + e);
      }
    }

    // 2. ç”Ÿæˆå‡¦ç†
    async function generate() {
      const prompt = document.getElementById('prompt').value;
      const out = document.getElementById('output');
      const btn = document.getElementById('sendBtn');
      const st = document.getElementById('status');
      
      if (!prompt) return alert("ãŠé¡Œã‚’æ›¸ã„ã¦ãã‚Œã€‚");

      // UIæº–å‚™
      btn.disabled = true;
      st.innerText = "Claude 3.5 Sonnet ãŒæ€è€ƒä¸­...";
      out.style.opacity = "0.5";

      try {
        // AIã¸é€ä¿¡
        const resp = await puter.ai.chat(prompt, { model: 'claude-3-5-sonnet' });

        // â˜…ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ: ã©ã‚“ãªå½¢å¼ã§æ¥ã¦ã‚‚ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠœãå‡ºã™ãƒ­ã‚¸ãƒƒã‚¯
        let text = "";
        const content = resp?.message?.content;

        if (typeof content === 'string') {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³A: ã„ããªã‚Šæ–‡å­—åˆ—ãŒå…¥ã£ã¦ã„ã‚‹å ´åˆ
            text = content;
        } else if (Array.isArray(content)) {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³B: é…åˆ—ã®ä¸­ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚ã‚‹å ´åˆ
            text = content[0]?.text || JSON.stringify(content);
        } else {
            // ãƒ‘ã‚¿ãƒ¼ãƒ³C: ãã®ä»–ï¼ˆå¿µã®ãŸã‚å…¨æ–‡å‡ºã™ï¼‰
            text = resp?.text || JSON.stringify(resp, null, 2);
        }

        out.innerText = text;

      } catch (e) {
        out.innerText = "ã‚¨ãƒ©ãƒ¼: " + (e.message || JSON.stringify(e));
      } finally {
        // å¾Œå§‹æœ«
        btn.disabled = false;
        st.innerText = "å®Œäº†";
        out.style.opacity = "1";
      }
    }
  </script>
</body>
</html>
